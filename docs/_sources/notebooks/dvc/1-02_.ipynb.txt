{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "de78ef42-2bb8-4a1d-9fc1-0263dd5e2fe4",
   "metadata": {
    "tags": []
   },
   "source": [
    "Data Pipelines en DVC --- 0:00 min\n",
    "===\n",
    "\n",
    "* 0:00 min | Ultima modificación: Abril 4, 2022 | YouTube"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "889ca005-9303-493a-bc76-2187b92c2f3d",
   "metadata": {},
   "source": [
    "**No funciona a gran escala, pero este es un buen ejemplo de pipelines**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "f9ccd433-5ee9-4f64-a6b2-c53c21f1ce04",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting dvc\n",
      "  Using cached dvc-2.10.1-py3-none-any.whl (400 kB)\n",
      "Collecting nanotime>=0.5.2\n",
      "  Using cached nanotime-0.5.2.tar.gz (3.2 kB)\n",
      "  Preparing metadata (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25hCollecting dpath<3,>=2.0.2\n",
      "  Using cached dpath-2.0.6-py3-none-any.whl (15 kB)\n",
      "Collecting python-benedict>=0.24.2\n",
      "  Using cached python_benedict-0.25.0-py3-none-any.whl (40 kB)\n",
      "Requirement already satisfied: pathspec<0.10.0,>=0.9.0 in /usr/local/lib/python3.8/dist-packages (from dvc) (0.9.0)\n",
      "Collecting dictdiffer>=0.8.1\n",
      "  Using cached dictdiffer-0.9.0-py2.py3-none-any.whl (16 kB)\n",
      "Collecting zc.lockfile>=1.2.1\n",
      "  Using cached zc.lockfile-2.0-py2.py3-none-any.whl (9.7 kB)\n",
      "Collecting aiohttp-retry>=2.4.5\n",
      "  Using cached aiohttp_retry-2.4.6-py3-none-any.whl (7.7 kB)\n",
      "Collecting colorama>=0.3.9\n",
      "  Using cached colorama-0.4.4-py2.py3-none-any.whl (16 kB)\n",
      "Requirement already satisfied: tqdm<5,>=4.63.1 in /usr/local/lib/python3.8/dist-packages (from dvc) (4.64.0)\n",
      "Collecting rich>=10.13.0\n",
      "  Using cached rich-12.2.0-py3-none-any.whl (229 kB)\n",
      "Collecting toml>=0.10.1\n",
      "  Using cached toml-0.10.2-py2.py3-none-any.whl (16 kB)\n",
      "Collecting appdirs>=1.4.3\n",
      "  Using cached appdirs-1.4.4-py2.py3-none-any.whl (9.6 kB)\n",
      "Requirement already satisfied: psutil>=5.8.0 in /usr/local/lib/python3.8/dist-packages (from dvc) (5.9.0)\n",
      "Requirement already satisfied: tabulate>=0.8.7 in /usr/local/lib/python3.8/dist-packages (from dvc) (0.8.9)\n",
      "Collecting funcy>=1.14\n",
      "  Using cached funcy-1.17-py2.py3-none-any.whl (33 kB)\n",
      "Collecting fsspec[http]>=2021.10.1\n",
      "  Using cached fsspec-2022.3.0-py3-none-any.whl (136 kB)\n",
      "Requirement already satisfied: typing-extensions>=3.7.4 in /usr/local/lib/python3.8/dist-packages (from dvc) (4.1.1)\n",
      "Collecting flufl.lock>=5\n",
      "  Using cached flufl.lock-7.0-py3-none-any.whl (11 kB)\n",
      "Collecting pydot>=1.2.4\n",
      "  Using cached pydot-1.4.2-py2.py3-none-any.whl (21 kB)\n",
      "Requirement already satisfied: requests>=2.22.0 in /usr/local/lib/python3.8/dist-packages (from dvc) (2.27.1)\n",
      "Collecting shtab<2,>=1.3.4\n",
      "  Using cached shtab-1.5.4-py2.py3-none-any.whl (13 kB)\n",
      "Requirement already satisfied: pyparsing>=2.4.7 in /usr/local/lib/python3.8/dist-packages (from dvc) (3.0.8)\n",
      "Requirement already satisfied: importlib-resources>=5.2.2 in /usr/local/lib/python3.8/dist-packages (from dvc) (5.7.0)\n",
      "Collecting distro>=1.3.0\n",
      "  Using cached distro-1.7.0-py3-none-any.whl (20 kB)\n",
      "Collecting voluptuous>=0.11.7\n",
      "  Using cached voluptuous-0.13.1-py3-none-any.whl (29 kB)\n",
      "Collecting scmrepo==0.0.16\n",
      "  Using cached scmrepo-0.0.16-py3-none-any.whl (40 kB)\n",
      "Requirement already satisfied: packaging>=19.0 in /usr/local/lib/python3.8/dist-packages (from dvc) (21.3)\n",
      "Collecting ruamel.yaml>=0.17.11\n",
      "  Using cached ruamel.yaml-0.17.21-py3-none-any.whl (109 kB)\n",
      "Collecting pygtrie>=2.3.2\n",
      "  Using cached pygtrie-2.4.2.tar.gz (35 kB)\n",
      "  Preparing metadata (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25hCollecting dvc-render==0.0.4\n",
      "  Using cached dvc_render-0.0.4-py3-none-any.whl (14 kB)\n",
      "Collecting configobj>=5.0.6\n",
      "  Using cached configobj-5.0.6.tar.gz (33 kB)\n",
      "  Preparing metadata (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25hCollecting shortuuid>=0.5.0\n",
      "  Using cached shortuuid-1.0.8-py3-none-any.whl (9.5 kB)\n",
      "Collecting flatten-dict<1,>=0.4.1\n",
      "  Using cached flatten_dict-0.4.2-py2.py3-none-any.whl (9.7 kB)\n",
      "Collecting networkx>=2.5\n",
      "  Using cached networkx-2.8-py3-none-any.whl (2.0 MB)\n",
      "Collecting grandalf==0.6\n",
      "  Using cached grandalf-0.6-py3-none-any.whl (31 kB)\n",
      "Collecting diskcache>=5.2.1\n",
      "  Using cached diskcache-5.4.0-py3-none-any.whl (44 kB)\n",
      "Collecting future\n",
      "  Downloading future-0.18.2.tar.gz (829 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m829.2/829.2 KB\u001b[0m \u001b[31m2.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0ma \u001b[36m0:00:01\u001b[0m\n",
      "\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25hCollecting pygit2>=1.7.2\n",
      "  Downloading pygit2-1.9.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.5 MB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m4.5/4.5 MB\u001b[0m \u001b[31m4.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m00:01\u001b[0m00:01\u001b[0m\n",
      "\u001b[?25hCollecting asyncssh<3,>=2.7.1\n",
      "  Downloading asyncssh-2.10.1-py3-none-any.whl (335 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m336.0/336.0 KB\u001b[0m \u001b[31m5.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m00:01\u001b[0m\n",
      "\u001b[?25hCollecting dulwich>=0.20.34\n",
      "  Downloading dulwich-0.20.35-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (552 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m552.2/552.2 KB\u001b[0m \u001b[31m3.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0ma \u001b[36m0:00:01\u001b[0m\n",
      "\u001b[?25hRequirement already satisfied: gitpython>3 in /usr/local/lib/python3.8/dist-packages (from scmrepo==0.0.16->dvc) (3.1.27)\n",
      "Collecting aiohttp\n",
      "  Downloading aiohttp-3.8.1-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (1.3 MB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.3/1.3 MB\u001b[0m \u001b[31m3.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m00:01\u001b[0m00:01\u001b[0mm\n",
      "\u001b[?25hRequirement already satisfied: six in /usr/local/lib/python3.8/dist-packages (from configobj>=5.0.6->dvc) (1.16.0)\n",
      "Collecting atpublic>=2.3\n",
      "  Downloading atpublic-3.0.1-py3-none-any.whl (4.8 kB)\n",
      "Requirement already satisfied: zipp>=3.1.0 in /usr/local/lib/python3.8/dist-packages (from importlib-resources>=5.2.2->dvc) (3.8.0)\n",
      "Collecting python-fsutil<1.0.0,>=0.6.0\n",
      "  Downloading python_fsutil-0.6.0-py3-none-any.whl (11 kB)\n",
      "Collecting mailchecker<5.0.0,>=4.1.0\n",
      "  Downloading mailchecker-4.1.15.tar.gz (231 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m231.1/231.1 KB\u001b[0m \u001b[31m3.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0ma \u001b[36m0:00:01\u001b[0m\n",
      "\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25hCollecting phonenumbers<9.0.0,>=8.12.0\n",
      "  Downloading phonenumbers-8.12.47-py2.py3-none-any.whl (2.6 MB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.6/2.6 MB\u001b[0m \u001b[31m3.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m00:01\u001b[0m00:01\u001b[0mm\n",
      "\u001b[?25hCollecting xmltodict<1.0.0,>=0.12.0\n",
      "  Downloading xmltodict-0.12.0-py2.py3-none-any.whl (9.2 kB)\n",
      "Requirement already satisfied: pyyaml<7.0,>=6.0 in /usr/local/lib/python3.8/dist-packages (from python-benedict>=0.24.2->dvc) (6.0)\n",
      "Requirement already satisfied: python-dateutil<3.0.0,>=2.8.0 in /usr/local/lib/python3.8/dist-packages (from python-benedict>=0.24.2->dvc) (2.8.2)\n",
      "Collecting ftfy<7.0.0,>=6.0.0\n",
      "  Downloading ftfy-6.1.1-py3-none-any.whl (53 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m53.1/53.1 KB\u001b[0m \u001b[31m4.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
      "\u001b[?25hCollecting python-slugify<7.0.0,>=6.0.1\n",
      "  Downloading python_slugify-6.1.1-py2.py3-none-any.whl (9.1 kB)\n",
      "Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests>=2.22.0->dvc) (1.26.9)\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests>=2.22.0->dvc) (2021.10.8)\n",
      "Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.8/dist-packages (from requests>=2.22.0->dvc) (2.0.12)\n",
      "Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests>=2.22.0->dvc) (3.3)\n",
      "Collecting commonmark<0.10.0,>=0.9.0\n",
      "  Downloading commonmark-0.9.1-py2.py3-none-any.whl (51 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m51.1/51.1 KB\u001b[0m \u001b[31m2.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
      "\u001b[?25hRequirement already satisfied: pygments<3.0.0,>=2.6.0 in /usr/local/lib/python3.8/dist-packages (from rich>=10.13.0->dvc) (2.11.2)\n",
      "Collecting ruamel.yaml.clib>=0.2.6\n",
      "  Downloading ruamel.yaml.clib-0.2.6-cp38-cp38-manylinux1_x86_64.whl (570 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m570.4/570.4 KB\u001b[0m \u001b[31m2.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0ma \u001b[36m0:00:01\u001b[0m\n",
      "\u001b[?25hRequirement already satisfied: setuptools in /usr/lib/python3/dist-packages (from zc.lockfile>=1.2.1->dvc) (45.2.0)\n",
      "Collecting cryptography>=3.1\n",
      "  Downloading cryptography-36.0.2-cp36-abi3-manylinux_2_24_x86_64.whl (3.6 MB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m3.6/3.6 MB\u001b[0m \u001b[31m2.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m00:01\u001b[0m00:01\u001b[0mm\n",
      "\u001b[?25hRequirement already satisfied: wcwidth>=0.2.5 in /usr/local/lib/python3.8/dist-packages (from ftfy<7.0.0,>=6.0.0->python-benedict>=0.24.2->dvc) (0.2.5)\n",
      "Requirement already satisfied: gitdb<5,>=4.0.1 in /usr/local/lib/python3.8/dist-packages (from gitpython>3->scmrepo==0.0.16->dvc) (4.0.9)\n",
      "Requirement already satisfied: cffi>=1.9.1 in /usr/local/lib/python3.8/dist-packages (from pygit2>=1.7.2->scmrepo==0.0.16->dvc) (1.15.0)\n",
      "Collecting text-unidecode>=1.3\n",
      "  Downloading text_unidecode-1.3-py2.py3-none-any.whl (78 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m78.2/78.2 KB\u001b[0m \u001b[31m5.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
      "\u001b[?25hCollecting multidict<7.0,>=4.5\n",
      "  Downloading multidict-6.0.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (121 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m121.3/121.3 KB\u001b[0m \u001b[31m4.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
      "\u001b[?25hCollecting yarl<2.0,>=1.0\n",
      "  Downloading yarl-1.7.2-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (308 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m308.6/308.6 KB\u001b[0m \u001b[31m3.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m00:01\u001b[0m00:01\u001b[0m\n",
      "\u001b[?25hRequirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp->aiohttp-retry>=2.4.5->dvc) (21.4.0)\n",
      "Collecting aiosignal>=1.1.2\n",
      "  Downloading aiosignal-1.2.0-py3-none-any.whl (8.2 kB)\n",
      "Collecting async-timeout<5.0,>=4.0.0a3\n",
      "  Downloading async_timeout-4.0.2-py3-none-any.whl (5.8 kB)\n",
      "Collecting frozenlist>=1.1.1\n",
      "  Downloading frozenlist-1.3.0-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (158 kB)\n",
      "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m158.7/158.7 KB\u001b[0m \u001b[31m3.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0ma \u001b[36m0:00:01\u001b[0m\n",
      "\u001b[?25hRequirement already satisfied: pycparser in /usr/local/lib/python3.8/dist-packages (from cffi>=1.9.1->pygit2>=1.7.2->scmrepo==0.0.16->dvc) (2.21)\n",
      "Requirement already satisfied: smmap<6,>=3.0.1 in /usr/local/lib/python3.8/dist-packages (from gitdb<5,>=4.0.1->gitpython>3->scmrepo==0.0.16->dvc) (5.0.0)\n",
      "Building wheels for collected packages: configobj, nanotime, pygtrie, mailchecker, future\n",
      "  Building wheel for configobj (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25h  Created wheel for configobj: filename=configobj-5.0.6-py3-none-any.whl size=34546 sha256=22de68a112bcb77e9c7458e0a22028002c1343f5e0929b123c7e00632acf44ca\n",
      "  Stored in directory: /root/.cache/pip/wheels/34/2a/24/a490264ae9041fd48f778ff393526572c80bb498ddecb07ea5\n",
      "  Building wheel for nanotime (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25h  Created wheel for nanotime: filename=nanotime-0.5.2-py3-none-any.whl size=2439 sha256=ef46cfab3234b2d4bdc299ede8776f6bf2e3f512275e929dbefd0362ba7dd752\n",
      "  Stored in directory: /root/.cache/pip/wheels/59/72/23/ea2daa0727a9f7824c0656b73c1f3d8d13f5327729eadb7084\n",
      "  Building wheel for pygtrie (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25h  Created wheel for pygtrie: filename=pygtrie-2.4.2-py3-none-any.whl size=19062 sha256=834d3287ff6a83fa91de77381088baa94a11447937f6cd8663fd20a435e2ca05\n",
      "  Stored in directory: /root/.cache/pip/wheels/31/03/7b/f685b394a937bc97d2d40908d45aa31f3d9473bca6e9019153\n",
      "  Building wheel for mailchecker (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25h  Created wheel for mailchecker: filename=mailchecker-4.1.15-py3-none-any.whl size=231268 sha256=9fa999253a8a955515403bb5d9117a56fea80361ea7f9b0dd9ac3cb185d46e9b\n",
      "  Stored in directory: /root/.cache/pip/wheels/fc/8c/36/2c71edd5b466f40d1ab327d9568ff9b663bd4c38cfce30da23\n",
      "  Building wheel for future (setup.py) ... \u001b[?25ldone\n",
      "\u001b[?25h  Created wheel for future: filename=future-0.18.2-py3-none-any.whl size=491058 sha256=be3d02e5eb80587a3d512bfa40098c20341252f64f617074fcac527df5b16c44\n",
      "  Stored in directory: /root/.cache/pip/wheels/8e/70/28/3d6ccd6e315f65f245da085482a2e1c7d14b90b30f239e2cf4\n",
      "Successfully built configobj nanotime pygtrie mailchecker future\n",
      "Installing collected packages: voluptuous, text-unidecode, python-fsutil, pygtrie, phonenumbers, nanotime, mailchecker, funcy, dictdiffer, commonmark, appdirs, zc.lockfile, xmltodict, toml, shtab, shortuuid, ruamel.yaml.clib, rich, python-slugify, pydot, networkx, multidict, future, ftfy, fsspec, frozenlist, flatten-dict, dvc-render, dulwich, dpath, distro, diskcache, configobj, colorama, atpublic, async-timeout, yarl, ruamel.yaml, python-benedict, pygit2, grandalf, flufl.lock, cryptography, aiosignal, asyncssh, aiohttp, scmrepo, aiohttp-retry, dvc\n",
      "Successfully installed aiohttp-3.8.1 aiohttp-retry-2.4.6 aiosignal-1.2.0 appdirs-1.4.4 async-timeout-4.0.2 asyncssh-2.10.1 atpublic-3.0.1 colorama-0.4.4 commonmark-0.9.1 configobj-5.0.6 cryptography-36.0.2 dictdiffer-0.9.0 diskcache-5.4.0 distro-1.7.0 dpath-2.0.6 dulwich-0.20.35 dvc-2.10.1 dvc-render-0.0.4 flatten-dict-0.4.2 flufl.lock-7.0 frozenlist-1.3.0 fsspec-2022.3.0 ftfy-6.1.1 funcy-1.17 future-0.18.2 grandalf-0.6 mailchecker-4.1.15 multidict-6.0.2 nanotime-0.5.2 networkx-2.8 phonenumbers-8.12.47 pydot-1.4.2 pygit2-1.9.1 pygtrie-2.4.2 python-benedict-0.25.0 python-fsutil-0.6.0 python-slugify-6.1.1 rich-12.2.0 ruamel.yaml-0.17.21 ruamel.yaml.clib-0.2.6 scmrepo-0.0.16 shortuuid-1.0.8 shtab-1.5.4 text-unidecode-1.3 toml-0.10.2 voluptuous-0.13.1 xmltodict-0.12.0 yarl-1.7.2 zc.lockfile-2.0\n",
      "\u001b[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\u001b[0m\u001b[33m\n",
      "\u001b[0m"
     ]
    }
   ],
   "source": [
    "!pip3 install --quiet dvc"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "50690e86-cae1-4ede-a46d-ecca541ec8f8",
   "metadata": {},
   "outputs": [],
   "source": [
    "#\n",
    "# Limpieza del área de trabajo\n",
    "#\n",
    "!rm -rf /tmp/pipeline /tmp/dvcstore"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "29d2d974-017f-49ee-a55a-a91c7bbacb0f",
   "metadata": {},
   "source": [
    "Creación de una carpeta temporal para el demo\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "0ae17353-4f61-46ec-823a-d94a5eb2b370",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/tmp/pipeline\n"
     ]
    }
   ],
   "source": [
    "!mkdir /tmp/pipeline\n",
    "!mkdir /tmp/pipeline/data\n",
    "%cd /tmp/pipeline"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7a85a4e8-426b-42ca-bb01-d4c3ab7ef38f",
   "metadata": {
    "tags": []
   },
   "source": [
    "Inicializacion de git\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "bde1bf4e-6326-42fe-8066-b19b2fcc4795",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Initialized empty Git repository in /tmp/pipeline/.git/\n"
     ]
    }
   ],
   "source": [
    "!git init\n",
    "!git config user.email jdvelasq@unal.edu.co\n",
    "!git config user.name jdvelasq"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "06c0b23f-7257-41f3-a575-9de12ce33c07",
   "metadata": {},
   "source": [
    "Inicialización de DVC\n",
    "--"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "52856bee-56f9-48c5-97f4-a9768b6d9228",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Initialized DVC repository.\n",
      "\n",
      "You can now commit the changes to git.\n",
      "\n",
      "\u001b[31m+---------------------------------------------------------------------+\n",
      "\u001b[0m\u001b[31m|\u001b[0m                                                                     \u001b[31m|\u001b[0m\n",
      "\u001b[31m|\u001b[0m        DVC has enabled anonymous aggregate usage analytics.         \u001b[31m|\u001b[0m\n",
      "\u001b[31m|\u001b[0m     Read the analytics documentation (and how to opt-out) here:     \u001b[31m|\u001b[0m\n",
      "\u001b[31m|\u001b[0m             <\u001b[36mhttps://dvc.org/doc/user-guide/analytics\u001b[39m>              \u001b[31m|\u001b[0m\n",
      "\u001b[31m|\u001b[0m                                                                     \u001b[31m|\u001b[0m\n",
      "\u001b[31m+---------------------------------------------------------------------+\n",
      "\u001b[0m\n",
      "\u001b[33mWhat's next?\u001b[39m\n",
      "\u001b[33m------------\u001b[39m\n",
      "- Check out the documentation: <\u001b[36mhttps://dvc.org/doc\u001b[39m>\n",
      "- Get help and share ideas: <\u001b[36mhttps://dvc.org/chat\u001b[39m>\n",
      "- Star us on GitHub: <\u001b[36mhttps://github.com/iterative/dvc\u001b[39m>\n",
      "\u001b[0m"
     ]
    }
   ],
   "source": [
    "!dvc init"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d1760d80-ec72-465a-89bb-86ecb4e8524b",
   "metadata": {
    "tags": []
   },
   "source": [
    "Descarga del proyecto ejemplo de DVC\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "0ab1ec6c-e9bb-411b-9036-6dd171cb7812",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Get:1 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]\n",
      "Get:2 http://archive.ubuntu.com/ubuntu focal InRelease [265 kB]\n",
      "Get:3 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\n",
      "Get:4 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [1139 kB]\n",
      "Get:5 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]\n",
      "Get:6 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [1771 kB]\n",
      "Get:7 http://archive.ubuntu.com/ubuntu focal/universe amd64 Packages [11.3 MB]\n",
      "Get:8 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [25.8 kB]\n",
      "Get:9 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [870 kB]\n",
      "Get:10 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [177 kB]\n",
      "Get:11 http://archive.ubuntu.com/ubuntu focal/main amd64 Packages [1275 kB]\n",
      "Get:12 http://archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [33.4 kB]\n",
      "Get:13 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1153 kB]\n",
      "Get:14 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2186 kB]\n",
      "Get:15 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [30.3 kB]\n",
      "Get:16 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [1214 kB]\n",
      "Get:17 http://archive.ubuntu.com/ubuntu focal-backports/main amd64 Packages [51.2 kB]\n",
      "Get:18 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [26.0 kB]\n",
      "Fetched 21.9 MB in 44s (502 kB/s)\n",
      "Reading package lists...\n",
      "Reading package lists...\n",
      "Building dependency tree...\n",
      "Reading state information...\n",
      "Suggested packages:\n",
      "  zip\n",
      "The following NEW packages will be installed:\n",
      "  unzip\n",
      "0 upgraded, 1 newly installed, 0 to remove and 4 not upgraded.\n",
      "Need to get 169 kB of archives.\n",
      "After this operation, 593 kB of additional disk space will be used.\n",
      "Get:1 http://archive.ubuntu.com/ubuntu focal/main amd64 unzip amd64 6.0-25ubuntu1 [169 kB]\n",
      "Fetched 169 kB in 1s (267 kB/s)\n",
      "debconf: delaying package configuration, since apt-utils is not installed\n",
      "Selecting previously unselected package unzip.\n",
      "(Reading database ... 35650 files and directories currently installed.)\n",
      "Preparing to unpack .../unzip_6.0-25ubuntu1_amd64.deb ...\n",
      "Unpacking unzip (6.0-25ubuntu1) ...\n",
      "Setting up unzip (6.0-25ubuntu1) ...\n",
      "Processing triggers for mime-support (3.64ubuntu1) ...\n"
     ]
    }
   ],
   "source": [
    "!apt-get -q update\n",
    "!apt-get -q install unzip"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "113e47fa-4a0f-461e-9731-232459298516",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "--2022-04-22 20:41:34--  https://code.dvc.org/get-started/code.zip\n",
      "Resolving code.dvc.org (code.dvc.org)... 104.21.81.205, 172.67.164.76, 2606:4700:3033::ac43:a44c, ...\n",
      "Connecting to code.dvc.org (code.dvc.org)|104.21.81.205|:443... connected.\n",
      "HTTP request sent, awaiting response... 303 See Other\n",
      "Location: https://s3-us-east-2.amazonaws.com/dvc-public/code/get-started/code.zip [following]\n",
      "--2022-04-22 20:41:35--  https://s3-us-east-2.amazonaws.com/dvc-public/code/get-started/code.zip\n",
      "Resolving s3-us-east-2.amazonaws.com (s3-us-east-2.amazonaws.com)... 52.219.93.1\n",
      "Connecting to s3-us-east-2.amazonaws.com (s3-us-east-2.amazonaws.com)|52.219.93.1|:443... connected.\n",
      "HTTP request sent, awaiting response... 200 OK\n",
      "Length: 5405 (5.3K) [application/zip]\n",
      "Saving to: ‘code.zip’\n",
      "\n",
      "code.zip            100%[===================>]   5.28K  --.-KB/s    in 0s      \n",
      "\n",
      "2022-04-22 20:41:35 (92.8 MB/s) - ‘code.zip’ saved [5405/5405]\n",
      "\n",
      "Archive:  code.zip\n",
      "  inflating: params.yaml             \n",
      "  inflating: src/evaluate.py         \n",
      "  inflating: src/featurization.py    \n",
      "  inflating: src/prepare.py          \n",
      "  inflating: src/requirements.txt    \n",
      "  inflating: src/train.py            \n",
      "   creating: .github/workflows/\n",
      "  inflating: .github/workflows/cml.yaml  \n",
      "  inflating: .devcontainer/Dockerfile  \n",
      "  inflating: .devcontainer/devcontainer.json  \n",
      "data\n",
      "params.yaml\n",
      "src\n"
     ]
    }
   ],
   "source": [
    "!wget https://code.dvc.org/get-started/code.zip\n",
    "!unzip code.zip\n",
    "!rm -f code.zip\n",
    "!ls -1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "6d55099a-9ef4-4399-9ff3-e140fb90b36b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\u001b[0m\u001b[01;34mdata\u001b[0m/\n",
      "params.yaml\n",
      "\u001b[01;34msrc\u001b[0m/\n"
     ]
    }
   ],
   "source": [
    "ls -1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "0c3f32d4-9dd0-4bf8-b9e6-66c843b9d67c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "src/:\n",
      "total 20\n",
      "-rw-r--r-- 1 root root 1943 Mar 30 03:59 evaluate.py\n",
      "-rw-r--r-- 1 root root 2391 Mar 30 03:59 featurization.py\n",
      "-rw-r--r-- 1 root root 1581 Mar 30 03:59 prepare.py\n",
      "-rw-r--r-- 1 root root   32 Mar 30 03:59 requirements.txt\n",
      "-rw-r--r-- 1 root root  964 Mar 30 03:59 train.py\n"
     ]
    }
   ],
   "source": [
    "!ls -lR src/"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e95faa64-5f51-4c88-bb3d-656b30b63df9",
   "metadata": {},
   "source": [
    "Instalación paquetes\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "968fb547-7a28-48cd-b555-c245961060a8",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\u001b[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\u001b[0m\u001b[33m\n",
      "\u001b[0m"
     ]
    }
   ],
   "source": [
    "!pip install --quiet -r src/requirements.txt"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "912cf99a-e3f3-4746-a993-50d199802033",
   "metadata": {
    "tags": []
   },
   "source": [
    "Pipeline Stages\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fd562b14-baa3-4c30-8697-74fe1a2f059f",
   "metadata": {},
   "outputs": [],
   "source": [
    "!pwd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "2a109528-dcdd-4692-a8a8-2645aa109bc7",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Creating 'dvc.yaml'\n",
      "Adding stage 'prepare' in 'dvc.yaml'\n",
      "\n",
      "To track the changes with git, run:\n",
      "\n",
      "    git add data/.gitignore dvc.yaml\n",
      "\n",
      "To enable auto staging, run:\n",
      "\n",
      "\tdvc config core.autostage true\n"
     ]
    }
   ],
   "source": [
    "%%bash\n",
    "dvc stage add -n prepare \\\n",
    "              -p prepare.seed,prepare.split \\\n",
    "              -d src/prepare.py -d data/data.xml \\\n",
    "              -o data/prepared \\\n",
    "              python src/prepare.py data/data.xml"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "9447d25d-169f-4fab-9e17-69a9fd1d83e4",
   "metadata": {},
   "outputs": [],
   "source": [
    "!ls data/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "bd867809-2307-4abe-bfde-7ddca6474d42",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'/tmp/pipeline'"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pwd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "3b33fdca-41be-4dc3-b6a9-73a64d7c3718",
   "metadata": {},
   "outputs": [],
   "source": [
    "!ls -1 data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "1a497eae-f783-466e-96a4-70ee3804ddb6",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "stages:\n",
      "  prepare:\n",
      "    cmd: python src/prepare.py data/data.xml\n",
      "    deps:\n",
      "    - data/data.xml\n",
      "    - src/prepare.py\n",
      "    params:\n",
      "    - prepare.seed\n",
      "    - prepare.split\n",
      "    outs:\n",
      "    - data/prepared\n"
     ]
    }
   ],
   "source": [
    "!cat dvc.yaml"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "377650cd-906f-4ef4-9cec-18ed1d65b643",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Adding stage 'train' in 'dvc.yaml'\n",
      "\n",
      "To track the changes with git, run:\n",
      "\n",
      "    git add .gitignore dvc.yaml\n",
      "\n",
      "To enable auto staging, run:\n",
      "\n",
      "\tdvc config core.autostage true\n"
     ]
    }
   ],
   "source": [
    "%%bash\n",
    "dvc stage add -n train \\\n",
    "              -p train.seed,train.n_est,train.min_split \\\n",
    "              -d src/train.py -d data/features \\\n",
    "              -o model.pkl \\\n",
    "              python src/train.py data/features model.pkl"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0a3a209f-21e3-44e3-995c-52a35bdc359f",
   "metadata": {},
   "source": [
    "Reproducción\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "574366c1-f557-446f-b988-ee85ca868814",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\u001b[31mERROR\u001b[39m: failed to reproduce 'train': [Errno 2] No such file or directory: '/tmp/pipeline/data/features'\n",
      "\u001b[0m"
     ]
    }
   ],
   "source": [
    "!dvc repro"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a55d167c-c08a-49e5-b811-c2083c7daf54",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e247be8b-d63e-4c73-9177-84043803a56d",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d7c991e3-126b-4fd3-a7e4-5f6128c29e25",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.10"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
